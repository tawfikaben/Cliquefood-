<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>دار حسنا - مطعم مغربي أصيل</title>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Lateef:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-primary: #9c2e2e;
      --color-secondary: #e67e22;
      --color-accent: #daa520;
      --color-text: #5d4037;
      --color-light: #f8f1e9;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Lateef', cursive;
      background-color: var(--color-light);
      color: var(--color-text);
      margin: 0;
      padding: 0;
      font-size: 18px;
      line-height: 1.6;
    }
    
    .container {
      width: 100%;
      margin: 0 auto;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 15px;
    }
    
    h1, h2, h3 {
      color: var(--color-primary);
      text-align: center;
      font-family: 'Amiri', serif;
    }
    
    h1 {
      font-size: 2.2rem;
    }
    
    .menu-section {
      margin-bottom: 30px;
      background-color: rgba(255, 248, 240, 0.7);
      padding: 15px;
      border-radius: 5px;
      border: 2px dashed var(--color-secondary);
    }
    
    .menu-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 5px;
      cursor: pointer;
      flex-wrap: wrap;
    }
    
    .item-name {
      font-weight: bold;
      color: var(--color-primary);
      font-size: 1.3rem;
      width: 70%;
    }
    
    .item-price {
      color: var(--color-primary);
      font-weight: bold;
      font-size: 1.3rem;
      width: 30%;
      text-align: left;
    }
    
    .item-desc {
      font-size: 1.1rem;
      color: var(--color-text);
      margin-top: 5px;
      width: 100%;
    }
    
    form {
      background-color: rgba(255, 248, 240, 0.9);
      padding: 20px;
      border-radius: 5px;
      margin-top: 30px;
      border: 2px solid var(--color-primary);
    }
    
    label, input, button {
      display: block;
      width: 100%;
      margin: 10px 0;
    }
    
    button {
      background-color: var(--color-primary);
      color: white;
      border: none;
      padding: 15px;
      border-radius: 5px;
      font-size: 1.3rem;
      font-family: 'Amiri', serif;
    }
    
    .commande-item {
      background-color: rgba(240, 240, 240, 0.9);
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    
    .total {
      font-weight: bold;
      font-size: 1.5rem;
      color: var(--color-primary);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>دار حسنا</h1>
    <p style="text-align: center; font-size: 1.4rem;">مطبخ مغربي أصيل منذ 1985</p>
    
    <h2>قائمتنا الشهية</h2>
    
    <div class="menu-section" id="main-dishes">
      <h3>الأطباق الرئيسية</h3>
      <div id="main-items"></div>
    </div>
    
    <div class="menu-section" id="appetizers">
      <h3>المقبلات والشوربات</h3>
      <div id="appetizer-items"></div>
    </div>
    
    <div class="menu-section" id="desserts">
      <h3>الحلويات والمشروبات</h3>
      <div id="dessert-items"></div>
    </div>
    
    <form id="commandeForm">
      <h2>تقديم الطلب</h2>
      
      <label for="table">رقم الطاولة:</label>
      <input type="number" id="table" min="1" required>
      
      <div id="listeCommandes"></div>
      
      <div class="total" id="totalCommande">المجموع: 0 درهم</div>
      
      <button type="submit">تأكيد الطلب</button>
    </form>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <script>
    // تكوين Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDpSF4J0bsd6T0ImMpse0KQQRADaxiYUQw",
      authDomain: "darhassna-484c3.firebaseapp.com",
      databaseURL: "https://darhassna-484c3-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "darhassna-484c3",
      storageBucket: "darhassna-484c3.firebasestorage.app",
      messagingSenderId: "141393162149",
      appId: "1:141393162149:web:0717227eac221f5ddfc24c"
    };

    // تهيئة Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let commandes = [];
    let total = 0;

    // تحميل القائمة من Firebase
    function loadMenu() {
      const categories = ['main', 'appetizers', 'desserts'];
      
      categories.forEach(category => {
        database.ref(`menu/${category}`).on('value', snapshot => {
          const items = snapshot.val();
          const container = document.getElementById(`${category}-items`);
          container.innerHTML = '';
          
          if (!items) return;
          
          Object.keys(items).forEach(key => {
            const item = items[key];
            const itemDiv = document.createElement('div');
            itemDiv.className = 'menu-item';
            itemDiv.setAttribute('data-plat', item.name);
            itemDiv.setAttribute('data-prix', item.price);
            itemDiv.innerHTML = `
              <div>
                <div class="item-name">${item.name}</div>
                <div class="item-desc">${item.desc || ''}</div>
              </div>
              <div class="item-price">${item.price} درهم</div>
            `;
            
            itemDiv.addEventListener('click', function() {
              addToOrder(item.name, item.price);
            });
            
            container.appendChild(itemDiv);
          });
        });
      });
    }

    // إضافة إلى الطلب
    function addToOrder(name, price) {
      commandes.push({
        plat: name,
        quantite: 1,
        prix: parseInt(price)
      });
      updateOrderList();
    }

    // تحديث قائمة الطلبات
    function updateOrderList() {
      const container = document.getElementById('listeCommandes');
      container.innerHTML = '';
      total = 0;
      
      commandes.forEach((item, index) => {
        const sousTotal = item.quantite * item.prix;
        total += sousTotal;
        
        const div = document.createElement('div');
        div.className = 'commande-item';
        div.innerHTML = `
          <div>${item.quantite} × ${item.plat}</div>
          <div>${sousTotal} درهم 
            <span onclick="removeItem(${index})" style="color:var(--color-primary);cursor:pointer;">×</span>
          </div>
        `;
        container.appendChild(div);
      });
      
      document.getElementById('totalCommande').textContent = `المجموع: ${total} درهم`;
    }

    // حذف من الطلب
    window.removeItem = function(index) {
      commandes.splice(index, 1);
      updateOrderList();
    };

    // إرسال الطلب
    document.getElementById('commandeForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const table = document.getElementById('table').value;
      
      if (!table || commandes.length === 0) {
        alert('الرجاء تحديد رقم الطاولة وإضافة طلب واحد على الأقل');
        return;
      }
      
      database.ref('commandes').push({
        table: table,
        commandes: commandes,
        total: total,
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        statut: 'في الانتظار'
      }).then(() => {
        alert(`تم تأكيد الطلب للطاولة ${table}! المجموع: ${total} درهم`);
        commandes = [];
        updateOrderList();
        document.getElementById('table').value = '';
      });
    });

    // تحميل القائمة عند بدء التشغيل
    loadMenu();
  </script>
</body>
</html>
